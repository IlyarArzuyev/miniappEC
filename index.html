<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
            background-color: #f4f4f4;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #333;
        }
        .info {
            margin: 10px 0;
            font-size: 18px;
        }
        .btn {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            background: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .btn-secondary {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
        <p class="info"><b>–§–ò–û:</b> <span id="clientName">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p class="info"><b>ID:</b> <span id="clientID">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p class="info"><b>–°—Ç–∞—Ç—É—Å:</b> <span id="clientStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p class="info"><b>–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:</b> <span id="nextStep">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        
        <a href="checklist.pdf" class="btn">üìÑ –°–∫–∞—á–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç</a>
        <button class="btn btn-secondary" onclick="openCalculator()">üìä –ò–ø–æ—Ç–µ—á–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        let userData = tg.initDataUnsafe.user;
        let userID = userData ? userData.id : "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";

        document.getElementById("clientID").innerText = userID;

        async function fetchClientData() {
            let response = await fetch("https://script.google.com/macros/s/AKfycbyVtaPtkbjVnDYI_ouXtWI7_3JdQa-2_-JPY2Qq6xs7qir7BOw2DDX7PAc8yfQoXLa-yQ/exec?id=" + userID);
            let data = await response.json();

            document.getElementById("clientName").innerText = data.name || "–ù–µ –Ω–∞–π–¥–µ–Ω–æ";
            document.getElementById("clientStatus").innerText = data.status || "–ù–µ –Ω–∞–π–¥–µ–Ω–æ";
            document.getElementById("nextStep").innerText = data.nextStep || "–ù–µ –Ω–∞–π–¥–µ–Ω–æ";
        }

        function openCalculator() {
            let sum = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∫—Ä–µ–¥–∏—Ç–∞:");
            let rate = prompt("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—É—é —Å—Ç–∞–≤–∫—É:");
            let downPayment = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å:");
            let term = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞ (–≤ –≥–æ–¥–∞—Ö):");

            if (sum && rate && downPayment && term) {
                let P = (parseFloat(rate) / 100) / 12;
                let N = parseFloat(term) * 12;
                let L = parseFloat(sum) - parseFloat(downPayment);
                let M = (L * P * Math.pow(1 + P, N)) / (Math.pow(1 + P, N) - 1);
                
                alert(`–í–∞—à –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂: ${M.toFixed(2)} —Ä—É–±.`);
            } else {
                alert("–û—à–∏–±–∫–∞! –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.");
            }
        }

        fetchClientData();
    </script>
</body>
</html>
